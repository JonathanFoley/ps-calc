<!DOCTYPE html>
<html>
  <head>
    <title>PS Remuneration Calculator</title>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/marked@0.3.6"></script>
    <script src="https://unpkg.com/lodash@4.16.0"></script>
    <link rel="stylesheet" type="text/css" href="/style.css" />
  </head>
  <body>
    <div id="app">
      <div>
        <p>Band: <input :value="band" @input="update_band" /></p>
      </div>

      <div v-bind="getBandSalary">
        <p>Min: &pound;{{ band_min }} Max: &pound;{{ band_max }}</p>
      </div>

      <div>
        <p>
          PS Pension Scheme (untick if opted out)
          <input type="checkbox" v-model="pension" v-bind:id="pension" />
        </p>
      </div>

      <div>
        <p v-if="pension">
          PS will contribute between &pound;{{pension_min}} and
          &pound;{{pension_max}} to your pension every year ({{ pension_type *
          100}}%).
        </p>
        <p v-else>
          You've opted out of the company pension scheme, so you are in complete
          control of your own pension contributions
        </p>
      </div>

      <div>Start Year: <input :value="start_year" @input="update_year" /></div>

      <div v-bind="yearsCalculated">
        <p>Years Service (this year): {{ years_service }}</p>
        <p>
          Based on your band and years service, we estimate you will have earned
          between:<br />
          &pound;{{earned_min}} - &pound;{{earned_max}}
        </p>
      </div>
      <div v-for="(perk, index) in getPerks" :key="index">
        Years Service: {{ perk.years }}, Perk: {{ perk.name }}
      </div>
    </div>

    <script>
      let bands = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

      new Vue({
        el: "#app",
        data: {
          band: "",
          start_year: "",
          years_service: 0,
          band_min: 0,
          band_max: 0,
          earned_min: 0,
          earned_max: 0,
          pension: true,
          pension_type: 0.03,
          pension_min: 0,
          pension_max: 0,
          salary: [
            { min: 100, max: 200, id: 1 },
            { min: 200, max: 300, id: 2 },
            { min: 300, max: 400, id: 3 },
            { min: 400, max: 500, id: 4 },
            { min: 500, max: 600, id: 5 },
            { min: 600, max: 700, id: 6 },
            { min: 700, max: 800, id: 7 },
            { min: 800, max: 900, id: 8 },
            { min: 900, max: 1000, id: 9 },
            { min: 1000, max: 1100, id: 10 }
          ],
          perks: [
            { name: "Free Gym", years: 0 },
            { name: "Free Parking", years: 0 },
            {
              name: "Pension match " + this.pension_type + "%",
              years: 0,
              pension: 1
            },
            { name: "Extra day holiday", years: 5 },
            { name: "Pension match 5%", years: 8, pension: 2 },
            { name: "Private Healthcare", years: 10 }
          ]
        },
        computed: {
          getBandSalary: function () {
            let current_salary = this.salary.find(
              (salary_band) => salary_band.id == this.band.trim()
            );

            if (current_salary) {
              this.band_min = current_salary.min;
              this.band_max = current_salary.max;

              this.earned_min = this.band_min * this.years_service;
              this.earned_max = this.band_max * this.years_service;

              if (this.pension) {
                this.pension_min = this.band_min * (0.0 + this.pension_type);
                this.pension_max = this.band_max * (0.0 + this.pension_type);
              }
            }
          },
          yearsCalculated: function () {
            let today = new Date();
            if (this.start_year >= 2000) {
              let start = new Date(this.start_year + "-01-01");
              this.years_service = today.getFullYear() - start.getFullYear();
              if (this.years_service >= 8) {
                this.pension_type = 0.05;
              }
            }
          },
          getPerks: function () {
            if (this.years_service) {
              return this.perks.filter((perk) => {
                if (this.years_service >= String(perk.years)) {
                  return perk;
                }
              });
            }
          },
          compiledMarkdown: function () {
            return marked(this.band, { sanitize: true });
          }
        },
        methods: {
          update_band: _.debounce(function (e) {
            this.band = e.target.value;
          }, 300),
          update_year: _.debounce(function (e) {
            this.start_year = e.target.value;
          }, 300)
        }
      });
    </script>
  </body>
</html>
